import{w as P,a as r,p as e}from"./chunk-NISHYRIK-bW9Td-MD.js";import{H as n}from"./Header-1hr30dbd.js";import{G as d,C as o,a,P as c,S as x,F as g}from"./grid.component-C3KD7pf_.js";import{I as m}from"./template-B_1vptV0.js";import"./utils-B6NI4t93.js";import"./sanitize-helper-CTTLmxlq.js";import"./button-qKIcIH9O.js";import"./index-kCI-pDpd.js";const C=()=>{const[s,N]=r.useState(null),[v,j]=r.useState(!0),[f,S]=r.useState(null),[h,_]=r.useState("month"),[l,T]=r.useState("overview"),[p,A]=r.useState("");r.useEffect(()=>{y()},[h,p]);const y=async()=>{try{j(!0);let t=`http://localhost:3000/api/admin/patrolStats?period=${h}`;p&&(t+=`&officer_id=${p}`);const i=await fetch(t,{method:"GET",headers:{"Content-Type":"application/json"}});if(!i.ok)throw new Error("Failed to fetch patrol statistics");const u=await i.json();if(u.success)N(u.data);else throw new Error(u.message||"Failed to fetch patrol statistics")}catch(t){S(t.message),console.error("Error fetching patrol statistics:",t)}finally{j(!1)}},b=t=>t?new Date(t).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A",w=t=>new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return v?e.jsxs("main",{className:"dashboard wrapper",children:[e.jsx(n,{title:"Patrol Statistics",description:"Monitor patrol activity and performance"}),e.jsx("div",{className:"flex-center p-8",children:e.jsx("p",{className:"p-18-regular text-gray-500",children:"Loading patrol statistics..."})})]}):f?e.jsxs("main",{className:"dashboard wrapper",children:[e.jsx(n,{title:"Patrol Statistics",description:"Monitor patrol activity and performance"}),e.jsx("div",{className:"error p-4",children:e.jsxs("p",{children:["Error: ",f]})})]}):s?e.jsxs("main",{className:"patrol-stats wrapper",children:[e.jsx(n,{title:"Patrol Statistics",description:"Monitor patrol activity and performance"}),e.jsxs("div",{className:"container",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-300 p-6 mb-6",children:e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Time Period"}),e.jsxs("select",{value:h,onChange:t=>_(t.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"day",children:"Today"}),e.jsx("option",{value:"week",children:"This Week"}),e.jsx("option",{value:"month",children:"This Month"}),e.jsx("option",{value:"year",children:"This Year"}),e.jsx("option",{value:"all",children:"All Time"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"View"}),e.jsxs("select",{value:l,onChange:t=>T(t.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"overview",children:"Overview"}),e.jsx("option",{value:"officers",children:"By Officer"}),e.jsx("option",{value:"locations",children:"By Location"}),e.jsx("option",{value:"daily",children:"Daily Breakdown"}),e.jsx("option",{value:"anomalies",children:"Anomalies"})]})]}),e.jsx("div",{className:"ml-auto",children:e.jsx("button",{onClick:y,className:"px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition",children:"Refresh Data"})})]})}),l==="overview"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-300 p-6",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-2",children:"Total Scans"}),e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:s.summary.total_scans}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Avg: ",s.summary.averages.scans_per_day.toFixed(1),"/day"]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-300 p-6",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-2",children:"Active Officers"}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:s.summary.unique_officers}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"On patrol duty"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-300 p-6",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-2",children:"Locations Covered"}),e.jsx("p",{className:"text-3xl font-bold text-purple-600",children:s.summary.unique_locations}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Avg: ",s.summary.averages.locations_per_day.toFixed(1),"/day"]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-300 p-6",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-2",children:"Anomalies"}),e.jsx("p",{className:"text-3xl font-bold text-red-600",children:s.anomaly_statistics.total}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[s.anomaly_statistics.by_status.pending||0," pending"]})]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-blue-900",children:["Viewing: ",e.jsx("span",{className:"font-bold capitalize",children:s.summary.period})]}),s.summary.date_range&&e.jsxs("p",{className:"text-xs text-blue-700 mt-1",children:[w(s.summary.date_range.start)," - ",w(s.summary.date_range.end)]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-blue-700",children:"First Patrol"}),e.jsx("p",{className:"text-sm font-semibold text-blue-900",children:b(s.summary.first_patrol)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-blue-700",children:"Last Patrol"}),e.jsx("p",{className:"text-sm font-semibold text-blue-900",children:b(s.summary.last_patrol)})]})]})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-300 p-6 mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Hourly Distribution"}),e.jsx("div",{className:"grid grid-cols-12 gap-2",children:Object.entries(s.hourly_distribution).sort(([t],[i])=>parseInt(t)-parseInt(i)).map(([t,i])=>e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-full bg-blue-500 rounded-t",style:{height:`${Math.max(i/Math.max(...Object.values(s.hourly_distribution))*100,5)}px`},title:`${i} scans`}),e.jsx("span",{className:"text-xs text-gray-600 mt-1",children:t}),e.jsx("span",{className:"text-xs font-semibold text-gray-800",children:i})]},t))}),e.jsx("p",{className:"text-xs text-gray-500 mt-4 text-center",children:"Patrol scans by hour of day"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-300 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Anomalies by Type"}),e.jsx("div",{className:"space-y-3",children:Object.entries(s.anomaly_statistics.by_type).map(([t,i])=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-700 capitalize",children:t.replace(/_/g," ")}),e.jsx("span",{className:"px-3 py-1 bg-red-100 text-red-700 rounded-full text-sm font-semibold",children:i})]},t))})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-300 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Anomalies by Status"}),e.jsx("div",{className:"space-y-3",children:Object.entries(s.anomaly_statistics.by_status).map(([t,i])=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-700 capitalize",children:t}),e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-semibold ${t==="resolved"?"bg-green-100 text-green-700":t==="pending"?"bg-yellow-100 text-yellow-700":"bg-orange-100 text-orange-700"}`,children:i})]},t))})]})]})]}),l==="officers"&&e.jsxs("div",{className:"bg-white rounded-xl shadow-300 p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Officer Performance"}),e.jsxs(d,{dataSource:s.officer_statistics,allowPaging:!0,allowSorting:!0,allowFiltering:!0,pageSettings:{pageSize:10,pageSizes:[10,25,50]},filterSettings:{type:"Excel"},width:"100%",children:[e.jsxs(o,{children:[e.jsx(a,{field:"employee_id",headerText:"Employee ID",width:"130"}),e.jsx(a,{field:"first_name",headerText:"First Name",width:"140"}),e.jsx(a,{field:"last_name",headerText:"Last Name",width:"140"}),e.jsx(a,{field:"total_scans",headerText:"Total Scans",width:"130",textAlign:"Center"}),e.jsx(a,{field:"unique_locations",headerText:"Locations",width:"120",textAlign:"Center"}),e.jsx(a,{field:"last_patrol",headerText:"Last Patrol",width:"180",format:"yMd h:mm a",type:"datetime"}),e.jsx(a,{field:"first_patrol",headerText:"First Patrol",width:"180",format:"yMd h:mm a",type:"datetime"})]}),e.jsx(m,{services:[c,x,g]})]})]}),l==="locations"&&e.jsxs("div",{className:"bg-white rounded-xl shadow-300 p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Location Coverage"}),e.jsxs(d,{dataSource:s.location_statistics,allowPaging:!0,allowSorting:!0,allowFiltering:!0,pageSettings:{pageSize:10,pageSizes:[10,25,50]},filterSettings:{type:"Excel"},width:"100%",children:[e.jsxs(o,{children:[e.jsx(a,{field:"gate_name",headerText:"Gate/Location",width:"150"}),e.jsx(a,{field:"location_description",headerText:"Description",width:"250"}),e.jsx(a,{field:"total_scans",headerText:"Total Scans",width:"130",textAlign:"Center"}),e.jsx(a,{field:"unique_officers",headerText:"Officers",width:"110",textAlign:"Center"}),e.jsx(a,{field:"last_patrol",headerText:"Last Patrol",width:"180",format:"yMd h:mm a",type:"datetime"})]}),e.jsx(m,{services:[c,x,g]})]})]}),l==="daily"&&e.jsxs("div",{className:"bg-white rounded-xl shadow-300 p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Daily Breakdown"}),e.jsxs(d,{dataSource:s.daily_statistics,allowPaging:!0,allowSorting:!0,pageSettings:{pageSize:15,pageSizes:[15,30,50]},width:"100%",children:[e.jsxs(o,{children:[e.jsx(a,{field:"date",headerText:"Date",width:"150",format:"yMd",type:"date"}),e.jsx(a,{field:"total_scans",headerText:"Total Scans",width:"150",textAlign:"Center"}),e.jsx(a,{field:"unique_officers",headerText:"Officers on Duty",width:"180",textAlign:"Center"}),e.jsx(a,{field:"unique_locations",headerText:"Locations Covered",width:"180",textAlign:"Center"})]}),e.jsx(m,{services:[c,x]})]})]}),l==="anomalies"&&e.jsxs("div",{className:"bg-white rounded-xl shadow-300 p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Recent Anomalies"}),s.recent_anomalies.length>0?e.jsxs(d,{dataSource:s.recent_anomalies,allowPaging:!0,allowSorting:!0,allowFiltering:!0,pageSettings:{pageSize:10},filterSettings:{type:"Excel"},width:"100%",children:[e.jsxs(o,{children:[e.jsx(a,{field:"anomaly_type",headerText:"Type",width:"150"}),e.jsx(a,{field:"detection_date",headerText:"Detected",width:"180",format:"yMd h:mm a",type:"datetime"}),e.jsx(a,{field:"status",headerText:"Status",width:"120"}),e.jsx(a,{field:"notes",headerText:"Notes",width:"300"})]}),e.jsx(m,{services:[c,x,g]})]}):e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No anomalies detected in this period"})]})]})]}):e.jsxs("main",{className:"dashboard wrapper",children:[e.jsx(n,{title:"Patrol Statistics",description:"Monitor patrol activity and performance"}),e.jsx("div",{className:"flex-center p-8",children:e.jsx("p",{className:"p-18-regular text-gray-500",children:"No patrol data available"})})]})},q=P(C);export{q as default};
