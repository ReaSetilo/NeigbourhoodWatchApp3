import{w as k,a as i,p as e}from"./chunk-NISHYRIK-bW9Td-MD.js";import{H as u}from"./Header-1hr30dbd.js";import{G as M,C as P,a as r,P as R,S as $,F as L}from"./grid.component-C3KD7pf_.js";import{I as D}from"./template-B_1vptV0.js";import"./utils-B6NI4t93.js";import"./sanitize-helper-CTTLmxlq.js";import"./button-qKIcIH9O.js";import"./index-kCI-pDpd.js";const F=()=>{const[p,j]=i.useState([]),[f,g]=i.useState(!0),[b,y]=i.useState(null),[N,n]=i.useState(!1),[t,v]=i.useState(null),[x,l]=i.useState(null),[d,m]=i.useState(""),[o,c]=i.useState(!1);i.useEffect(()=>{h()},[]);const h=async()=>{try{g(!0);const s=await fetch("http://localhost:3000/api/admin/houses",{method:"GET",headers:{"Content-Type":"application/json"}});if(!s.ok)throw new Error("Failed to fetch houses");const a=await s.json();if(a.success)j(a.data);else throw new Error(a.message||"Failed to fetch houses")}catch(s){y(s.message),console.error("Error fetching houses:",s)}finally{g(!1)}},w=s=>{v(s.data),l(null),m(""),n(!0)},_=async()=>{if(!d.trim()){alert("Please provide a suspension reason");return}c(!0);try{const a=await(await fetch(`http://localhost:3000/api/admin/houses/${t.house_id}`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({reason:d})})).json();a.success?(alert("House suspended successfully"),n(!1),h()):alert(`Error: ${a.message}`)}catch(s){alert(`Error: ${s.message}`),console.error("Error suspending house:",s)}finally{c(!1)}},S=async()=>{c(!0);try{const a=await(await fetch(`http://localhost:3000/api/admin/houses/${t.house_id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"reactivate"})})).json();a.success?(alert("House reactivated successfully"),n(!1),h()):alert(`Error: ${a.message}`)}catch(s){alert(`Error: ${s.message}`),console.error("Error reactivating house:",s)}finally{c(!1)}},C=s=>{const a={active:"bg-success-50 text-success-700",suspended:"bg-red-50 text-red-500",inactive:"bg-gray-200 text-gray-700",deleted:"bg-red-100 text-red-500"};return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${a[s.status]||"bg-gray-200 text-gray-700"}`,children:s.status})},T=s=>{const a={active:"bg-success-50 text-success-700",suspended:"bg-red-50 text-red-500",inactive:"bg-gray-200 text-gray-700",cancelled:"bg-red-100 text-red-500"};return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${a[s.subscription_status]||"bg-gray-200 text-gray-700"}`,children:s.subscription_status||"N/A"})},E=s=>e.jsx("div",{className:"flex-center",children:s.qr_active?e.jsx("span",{className:"text-success-500 text-lg font-semibold",children:"✓"}):e.jsx("span",{className:"text-red-500 text-lg font-semibold",children:"✗"})}),H=s=>{const a=s.missed_payments_count||0,A=a>2?"text-red-500":a>0?"text-red-100":"text-gray-500";return e.jsx("span",{className:`font-semibold ${A}`,children:a})};return f?e.jsxs("main",{className:"dashboard wrapper",children:[e.jsx(u,{title:"Houses Management",description:"View and manage all houses in the neighborhood"}),e.jsx("div",{className:"flex-center p-8",children:e.jsx("p",{className:"p-18-regular text-gray-500",children:"Loading houses..."})})]}):b?e.jsxs("main",{className:"dashboard wrapper",children:[e.jsx(u,{title:"Houses Management",description:"View and manage all houses in the neighborhood"}),e.jsx("div",{className:"error p-4",children:e.jsxs("p",{children:["Error: ",b]})})]}):e.jsxs("main",{className:"dashboard wrapper",children:[e.jsx(u,{title:"Houses Management",description:"View and manage all houses in the neighborhood"}),e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"flex-between mb-6",children:[e.jsx("h1",{className:"p-24-semibold text-dark-100",children:"All Houses"}),e.jsxs("p",{className:"p-16-semibold text-gray-500",children:["Total: ",p.length]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-300 p-6",children:e.jsxs(M,{dataSource:p,allowPaging:!0,allowSorting:!0,allowFiltering:!0,pageSettings:{pageSize:10,pageSizes:[10,25,50,100]},filterSettings:{type:"Excel"},width:"100%",rowSelected:w,children:[e.jsxs(P,{children:[e.jsx(r,{field:"house_id",headerText:"ID",width:"80",isPrimaryKey:!0,textAlign:"Center",visible:!0}),e.jsx(r,{field:"house_number",headerText:"House Number",width:"130"}),e.jsx(r,{field:"street_address",headerText:"Street Address",width:"200"}),e.jsx(r,{field:"status",headerText:"Status",width:"130",template:C}),e.jsx(r,{field:"gate_name",headerText:"Gate Name",width:"140"}),e.jsx(r,{field:"qr_active",headerText:"QR Active",width:"110",template:E,textAlign:"Center"}),e.jsx(r,{field:"member_first_name",headerText:"Member First Name",width:"150"}),e.jsx(r,{field:"member_last_name",headerText:"Member Last Name",width:"150"}),e.jsx(r,{field:"member_email",headerText:"Member Email",width:"200"}),e.jsx(r,{field:"member_phone",headerText:"Member Phone",width:"140"}),e.jsx(r,{field:"subscription_status",headerText:"Subscription",width:"140",template:T}),e.jsx(r,{field:"missed_payments_count",headerText:"Missed Payments",width:"140",template:H,textAlign:"Center"}),e.jsx(r,{field:"created_at",headerText:"Date Added",width:"140",format:"yMd",type:"date"})]}),e.jsx(D,{services:[R,$,L]})]})})]}),N&&t&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"border-b px-6 py-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900",children:["House Details - ",t.house_number]}),e.jsx("button",{onClick:()=>n(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),e.jsx("div",{className:"px-6 py-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"House Number"}),e.jsx("p",{className:"text-base font-semibold",children:t.house_number})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Status"}),e.jsx("span",{className:`inline-block px-2 py-1 rounded-full text-xs font-medium ${t.status==="active"?"bg-success-50 text-success-700":t.status==="suspended"?"bg-red-50 text-red-500":"bg-gray-200 text-gray-700"}`,children:t.status})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Street Address"}),e.jsx("p",{className:"text-base font-semibold",children:t.street_address||"N/A"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Gate Name"}),e.jsx("p",{className:"text-base font-semibold",children:t.gate_name||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"QR Active"}),e.jsx("p",{className:"text-base font-semibold",children:t.qr_active?"Yes":"No"})]})]}),e.jsxs("div",{className:"border-t pt-4 mt-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Member Information"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Name"}),e.jsxs("p",{className:"text-base font-semibold",children:[t.member_first_name," ",t.member_last_name]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Email"}),e.jsx("p",{className:"text-base font-semibold",children:t.member_email||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Phone"}),e.jsx("p",{className:"text-base font-semibold",children:t.member_phone||"N/A"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Subscription Status"}),e.jsx("p",{className:"text-base font-semibold",children:t.subscription_status||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Missed Payments"}),e.jsx("p",{className:`text-base font-semibold ${t.missed_payments_count>2?"text-red-500":t.missed_payments_count>0?"text-orange-500":"text-green-500"}`,children:t.missed_payments_count||0})]})]})]})]}),!x&&e.jsxs("div",{className:"border-t pt-4 mt-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Actions"}),e.jsx("div",{className:"space-y-2",children:t.status!=="suspended"?e.jsx("button",{onClick:()=>l("suspend"),className:"w-full px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition",children:"Suspend House"}):e.jsx("button",{onClick:()=>l("reactivate"),className:"w-full px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition",children:"Reactivate House"})})]}),x==="suspend"&&e.jsxs("div",{className:"border-t pt-4 mt-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3 text-red-600",children:"Suspend House"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Suspension Reason *"}),e.jsx("textarea",{value:d,onChange:s=>m(s.target.value),placeholder:"Enter reason for suspension...",rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:_,disabled:o||!d.trim(),className:"flex-1 px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition disabled:bg-gray-300 disabled:cursor-not-allowed",children:o?"Suspending...":"Confirm Suspension"}),e.jsx("button",{onClick:()=>{l(null),m("")},className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition",children:"Cancel"})]})]})]}),x==="reactivate"&&e.jsxs("div",{className:"border-t pt-4 mt-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3 text-green-600",children:"Reactivate House"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Are you sure you want to reactivate this house? This will restore full access for the member."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:S,disabled:o,className:"flex-1 px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition disabled:bg-gray-300 disabled:cursor-not-allowed",children:o?"Reactivating...":"Confirm Reactivation"}),e.jsx("button",{onClick:()=>l(null),className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition",children:"Cancel"})]})]})]})}),e.jsx("div",{className:"border-t px-6 py-4 bg-gray-50",children:e.jsx("button",{onClick:()=>n(!1),className:"w-full px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition",children:"Close"})})]})})]})},B=k(F);export{B as default};
