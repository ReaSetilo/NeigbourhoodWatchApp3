import{w as R,a,p as e}from"./chunk-NISHYRIK-bW9Td-MD.js";import{H as g}from"./Header-1hr30dbd.js";import{G as L,C as D,a as l,P,S as $,F}from"./grid.component-C3KD7pf_.js";import{I}from"./template-B_1vptV0.js";import"./utils-B6NI4t93.js";import"./sanitize-helper-CTTLmxlq.js";import"./button-qKIcIH9O.js";import"./index-kCI-pDpd.js";const U=()=>{const[b,v]=a.useState([]),[y,u]=a.useState(!0),[j,N]=a.useState(null),[w,o]=a.useState(!1),[s,S]=a.useState(null),[h,i]=a.useState(null),[f,d]=a.useState(""),[c,m]=a.useState(""),[n,x]=a.useState(!1);a.useEffect(()=>{p()},[]);const p=async()=>{try{u(!0);const t=await fetch("http://localhost:3000/api/admin/users",{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok)throw new Error("Failed to fetch users");const r=await t.json();if(r.success){const E=r.data.filter(T=>T.user_type==="neighborhood_member");v(E)}else throw new Error(r.message||"Failed to fetch users")}catch(t){N(t.message),console.error("Error fetching users:",t)}finally{u(!1)}},_=t=>{S(t.data),i(null),d(""),m(""),o(!0)},C=async()=>{x(!0);try{const r=await(await fetch(`http://localhost:3000/api/admin/users/${s.user_id}/approve`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({approval_notes:f||"Account approved by administrator"})})).json();r.success?(alert("✓ Member approved successfully!"),o(!1),i(null),d(""),p()):alert(`Error: ${r.message}`)}catch(t){alert(`Error: ${t.message}`),console.error("Error approving member:",t)}finally{x(!1)}},A=async()=>{if(!c.trim()){alert("Please provide a reason for rejection");return}x(!0);try{const r=await(await fetch(`http://localhost:3000/api/admin/users/${s.user_id}/reject`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({rejection_reason:c})})).json();r.success?(alert("✗ Member rejected successfully"),o(!1),i(null),m(""),p()):alert(`Error: ${r.message}`)}catch(t){alert(`Error: ${t.message}`),console.error("Error rejecting member:",t)}finally{x(!1)}},M=t=>{const r={pending_approval:"bg-yellow-50 text-yellow-700",active:"bg-success-50 text-success-700",suspended:"bg-red-50 text-red-500",inactive:"bg-gray-200 text-gray-700",deleted:"bg-red-100 text-red-500"};return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${r[t.status]||"bg-gray-200 text-gray-700"}`,children:t.status})},k=t=>e.jsx("div",{className:"flex-center",children:t.is_approved?e.jsx("span",{className:"text-success-500 text-lg font-semibold",children:"✓"}):e.jsx("span",{className:"text-red-500 text-lg font-semibold",children:"✗"})});return y?e.jsxs("main",{className:"dashboard wrapper",children:[e.jsx(g,{title:"Neighborhood Members",description:"View and manage neighborhood member accounts"}),e.jsx("div",{className:"flex-center p-8",children:e.jsx("p",{className:"p-18-regular text-gray-500",children:"Loading members..."})})]}):j?e.jsxs("main",{className:"dashboard wrapper",children:[e.jsx(g,{title:"Neighborhood Members",description:"View and manage neighborhood member accounts"}),e.jsx("div",{className:"error p-4",children:e.jsxs("p",{children:["Error: ",j]})})]}):e.jsxs("main",{className:"members wrapper",children:[e.jsx(g,{title:"Neighborhood Members",description:"View and manage neighborhood member accounts"}),e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"flex-between mb-6",children:[e.jsx("h1",{className:"p-24-semibold text-dark-100",children:"Neighborhood Members"}),e.jsxs("p",{className:"p-16-semibold text-gray-500",children:["Total: ",b.length]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-300 p-6",children:e.jsxs(L,{dataSource:b,allowPaging:!0,allowSorting:!0,allowFiltering:!0,pageSettings:{pageSize:10,pageSizes:[10,25,50,100]},filterSettings:{type:"Excel"},width:"100%",rowSelected:_,children:[e.jsxs(D,{children:[e.jsx(l,{field:"user_id",headerText:"ID",width:"80",isPrimaryKey:!0,textAlign:"Center",visible:!1}),e.jsx(l,{field:"first_name",headerText:"First Name",width:"140"}),e.jsx(l,{field:"last_name",headerText:"Last Name",width:"140"}),e.jsx(l,{field:"email",headerText:"Email",width:"220"}),e.jsx(l,{field:"phone_number",headerText:"Phone",width:"140"}),e.jsx(l,{field:"status",headerText:"Status",width:"130",template:M}),e.jsx(l,{field:"is_approved",headerText:"Approved",width:"110",template:k,textAlign:"Center"}),e.jsx(l,{field:"last_login",headerText:"Last Login",width:"140",format:"yMd",type:"date"}),e.jsx(l,{field:"created_at",headerText:"Joined Date",width:"140",format:"yMd",type:"date"})]}),e.jsx(I,{services:[P,$,F]})]})})]}),w&&s&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"border-b px-6 py-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900",children:["Member Details - ",s.first_name," ",s.last_name]}),e.jsx("button",{onClick:()=>o(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),e.jsx("div",{className:"px-6 py-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Personal Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"First Name"}),e.jsx("p",{className:"text-base font-semibold",children:s.first_name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Last Name"}),e.jsx("p",{className:"text-base font-semibold",children:s.last_name})]})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Contact Information"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Email"}),e.jsx("p",{className:"text-base font-semibold",children:s.email})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Phone Number"}),e.jsx("p",{className:"text-base font-semibold",children:s.phone_number||"N/A"})]})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Account Status"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Status"}),e.jsx("span",{className:`inline-block px-2 py-1 rounded-full text-xs font-medium ${s.status==="active"?"bg-success-50 text-success-700":s.status==="pending_approval"?"bg-yellow-50 text-yellow-700":s.status==="suspended"?"bg-red-50 text-red-500":"bg-gray-200 text-gray-700"}`,children:s.status})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Approved"}),e.jsx("p",{className:`text-base font-semibold ${s.is_approved?"text-green-600":"text-red-600"}`,children:s.is_approved?"Yes ✓":"No ✗"})]})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Account Dates"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Joined Date"}),e.jsx("p",{className:"text-base font-semibold",children:s.created_at?new Date(s.created_at).toLocaleDateString():"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Last Login"}),e.jsx("p",{className:"text-base font-semibold",children:s.last_login?new Date(s.last_login).toLocaleDateString():"Never"})]})]})]}),!h&&e.jsxs("div",{className:"border-t pt-4 mt-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Actions"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("button",{onClick:()=>i("approve"),disabled:s.is_approved&&s.status==="active",className:"px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition disabled:bg-gray-300 disabled:cursor-not-allowed",children:s.is_approved?"✓ Already Approved":"Approve Member"}),e.jsx("button",{onClick:()=>i("reject"),disabled:!s.is_approved&&s.status==="inactive",className:"px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition disabled:bg-gray-300 disabled:cursor-not-allowed",children:!s.is_approved&&s.status==="inactive"?"✗ Already Rejected":"Reject Member"})]})]}),h==="approve"&&e.jsxs("div",{className:"border-t pt-4 mt-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3 text-green-600",children:"Approve Member"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Approval Notes (Optional)"}),e.jsx("textarea",{value:f,onChange:t=>d(t.target.value),placeholder:"Enter any notes about this approval (e.g., 'Identity verified, documents checked')...",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"These notes are for internal records only."})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-green-700 mb-2",children:e.jsx("strong",{children:"Approving this member will:"})}),e.jsxs("ul",{className:"list-disc list-inside text-sm text-green-600 space-y-1",children:[e.jsx("li",{children:'Set account status to "active"'}),e.jsx("li",{children:"Grant full access to the system"}),e.jsx("li",{children:"Send approval notification to member"}),e.jsx("li",{children:"Allow member to login and use services"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:C,disabled:n,className:"flex-1 px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition disabled:bg-gray-300 disabled:cursor-not-allowed",children:n?"Approving...":"✓ Confirm Approval"}),e.jsx("button",{onClick:()=>{i(null),d("")},disabled:n,className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition",children:"Cancel"})]})]})]}),h==="reject"&&e.jsxs("div",{className:"border-t pt-4 mt-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3 text-red-600",children:"Reject Member"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Rejection Reason *"}),e.jsx("textarea",{value:c,onChange:t=>m(t.target.value),placeholder:"Enter reason for rejection (e.g., 'Unable to verify identity', 'Incomplete documents')...",rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"This reason will be sent to the member in their notification."})]}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-red-700 mb-2",children:e.jsx("strong",{children:"Rejecting this member will:"})}),e.jsxs("ul",{className:"list-disc list-inside text-sm text-red-600 space-y-1",children:[e.jsx("li",{children:'Set account status to "inactive"'}),e.jsx("li",{children:"Deny access to the system"}),e.jsx("li",{children:"Send rejection notification with reason"}),e.jsx("li",{children:"Prevent member from logging in"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:A,disabled:n||!c.trim(),className:"flex-1 px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition disabled:bg-gray-300 disabled:cursor-not-allowed",children:n?"Rejecting...":"✗ Confirm Rejection"}),e.jsx("button",{onClick:()=>{i(null),m("")},disabled:n,className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition",children:"Cancel"})]})]})]})]})}),e.jsx("div",{className:"border-t px-6 py-4 bg-gray-50",children:e.jsx("button",{onClick:()=>o(!1),disabled:n,className:"w-full px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition disabled:bg-gray-100",children:"Close"})})]})})]})},K=R(U);export{K as default};
