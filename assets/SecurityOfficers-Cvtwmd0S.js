import{w as Q,a as r,p as e}from"./chunk-NISHYRIK-bW9Td-MD.js";import{H as C}from"./Header-1hr30dbd.js";import{G as X,C as Z,a as n,P as ee,S as se,F as te}from"./grid.component-C3KD7pf_.js";import{I as ae}from"./template-B_1vptV0.js";import"./utils-B6NI4t93.js";import"./sanitize-helper-CTTLmxlq.js";import"./button-qKIcIH9O.js";import"./index-kCI-pDpd.js";const re=()=>{const[T,L]=r.useState([]),[$,O]=r.useState(!0),[A,F]=r.useState(null),[t,v]=r.useState(null),[M,k]=r.useState(!1),[i,E]=r.useState(null),[f,d]=r.useState(!1),[D,x]=r.useState(null),[R,u]=r.useState(null),[I,m]=r.useState(!1),[N,l]=r.useState(null),[P,g]=r.useState(""),[b,y]=r.useState(""),[o,j]=r.useState(!1),[c,w]=r.useState({suspension_reason:"",suspension_duration_days:90});r.useEffect(()=>{p()},[]);const p=async()=>{try{O(!0);const s=await fetch("http://localhost:3000/api/admin/users",{method:"GET",headers:{"Content-Type":"application/json"}});if(!s.ok)throw new Error("Failed to fetch users");const a=await s.json();if(a.success){const _=a.data.filter(Y=>Y.user_type==="security_officer");L(_)}else throw new Error(a.message||"Failed to fetch users")}catch(s){F(s.message),console.error("Error fetching users:",s)}finally{O(!1)}},J=s=>{v(s.data),!s.data.is_approved&&s.data.status==="pending_approval"?l("approve"):l(null),g(""),y(""),m(!0)},U=async()=>{j(!0);try{const a=await(await fetch(`http://localhost:3000/api/admin/users/${t.user_id}/approve`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({approval_notes:P||"Security officer approved by administrator"})})).json();a.success?(alert("✓ Security officer approved successfully!"),m(!1),l(null),g(""),p()):alert(`Error: ${a.message}`)}catch(s){alert(`Error: ${s.message}`),console.error("Error approving officer:",s)}finally{j(!1)}},q=async()=>{if(!b.trim()){alert("Please provide a reason for rejection");return}j(!0);try{const a=await(await fetch(`http://localhost:3000/api/admin/users/${t.user_id}/reject`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({rejection_reason:b})})).json();a.success?(alert("✗ Security officer rejected successfully"),m(!1),l(null),y(""),p()):alert(`Error: ${a.message}`)}catch(s){alert(`Error: ${s.message}`),console.error("Error rejecting officer:",s)}finally{j(!1)}},S=(s,a,_)=>{_.stopPropagation(),v(s),E(a),k(!0),x(null),u(null)},h=()=>{k(!1),v(null),E(null),w({suspension_reason:"",suspension_duration_days:90}),x(null),u(null)},z=async()=>{if(!c.suspension_reason.trim()){x("Suspension reason is required");return}try{d(!0);const s=await fetch(`http://localhost:3000/api/admin/officers/${t.user_id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"suspend",suspension_reason:c.suspension_reason,suspension_duration_days:c.suspension_duration_days})}),a=await s.json();if(!s.ok)throw new Error(a.message||"Failed to suspend officer");u("Officer suspended successfully!"),p(),setTimeout(()=>{h()},2e3)}catch(s){x(s.message)}finally{d(!1)}},G=async()=>{try{d(!0);const s=await fetch(`http://localhost:3000/api/admin/officers/${t.user_id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"activate"})}),a=await s.json();if(!s.ok)throw new Error(a.message||"Failed to reactivate officer");u("Officer reactivated successfully!"),p(),setTimeout(()=>{h()},2e3)}catch(s){x(s.message)}finally{d(!1)}},V=async()=>{try{d(!0);const s=await fetch(`http://localhost:3000/api/admin/officers/${t.user_id}`,{method:"DELETE",headers:{"Content-Type":"application/json"}}),a=await s.json();if(!s.ok)throw new Error(a.message||"Failed to delete officer");u("Officer deleted successfully!"),p(),setTimeout(()=>{h()},2e3)}catch(s){x(s.message)}finally{d(!1)}},B=s=>{s.preventDefault(),i==="suspend"?z():i==="activate"?G():i==="delete"&&V()},H=s=>{const a={pending_approval:"bg-yellow-50 text-yellow-700",active:"bg-success-50 text-success-700",suspended:"bg-red-50 text-red-500",inactive:"bg-gray-200 text-gray-700",deleted:"bg-red-100 text-red-500"};return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${a[s.status]||"bg-gray-200 text-gray-700"}`,children:s.status})},W=s=>e.jsx("div",{className:"flex-center",children:s.is_approved?e.jsx("span",{className:"text-success-500 text-lg font-semibold",children:"✓"}):e.jsx("span",{className:"text-red-500 text-lg font-semibold",children:"✗"})}),K=s=>e.jsxs("div",{className:"flex gap-2 justify-center",children:[s.status==="suspended"?e.jsx("button",{onClick:a=>S(s,"activate",a),className:"px-3 py-1 bg-success-500 hover:bg-success-600 text-white text-xs rounded-lg transition-colors",title:"Reactivate Officer",children:"Activate"}):e.jsx("button",{onClick:a=>S(s,"suspend",a),className:"px-3 py-1 bg-yellow-500 hover:bg-yellow-600 text-white text-xs rounded-lg transition-colors",title:"Suspend Officer",disabled:s.status==="pending_approval",children:"Suspend"}),e.jsx("button",{onClick:a=>S(s,"delete",a),className:"px-3 py-1 bg-red-500 hover:bg-red-600 text-white text-xs rounded-lg transition-colors",title:"Delete Officer",children:"Delete"})]});return $?e.jsxs("main",{className:"dashboard wrapper",children:[e.jsx(C,{title:"Security Officers",description:"View and manage security officer accounts"}),e.jsx("div",{className:"flex-center p-8",children:e.jsx("p",{className:"p-18-regular text-gray-500",children:"Loading security officers..."})})]}):A?e.jsxs("main",{className:"dashboard wrapper",children:[e.jsx(C,{title:"Security Officers",description:"View and manage security officer accounts"}),e.jsx("div",{className:"error p-4",children:e.jsxs("p",{children:["Error: ",A]})})]}):e.jsxs("main",{className:"security-officers wrapper",children:[e.jsx(C,{title:"Security Officers",description:"View and manage security officer accounts"}),e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"flex-between mb-6",children:[e.jsx("h1",{className:"p-24-semibold text-dark-100",children:"Security Officers"}),e.jsxs("p",{className:"p-16-semibold text-gray-500",children:["Total: ",T.length]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-300 p-6",children:e.jsxs(X,{dataSource:T,allowPaging:!0,allowSorting:!0,allowFiltering:!0,pageSettings:{pageSize:10,pageSizes:[10,25,50,100]},filterSettings:{type:"Excel"},width:"100%",rowSelected:J,children:[e.jsxs(Z,{children:[e.jsx(n,{field:"user_id",headerText:"ID",width:"80",isPrimaryKey:!0,textAlign:"Center",visible:!1}),e.jsx(n,{field:"first_name",headerText:"First Name",width:"140"}),e.jsx(n,{field:"last_name",headerText:"Last Name",width:"140"}),e.jsx(n,{field:"email",headerText:"Email",width:"220"}),e.jsx(n,{field:"phone_number",headerText:"Phone",width:"140"}),e.jsx(n,{field:"status",headerText:"Status",width:"130",template:H}),e.jsx(n,{field:"is_approved",headerText:"Approved",width:"110",template:W,textAlign:"Center"}),e.jsx(n,{field:"last_login",headerText:"Last Login",width:"140",format:"yMd",type:"date"}),e.jsx(n,{field:"created_at",headerText:"Joined Date",width:"140",format:"yMd",type:"date"}),e.jsx(n,{headerText:"Actions",width:"180",template:K,textAlign:"Center"})]}),e.jsx(ae,{services:[ee,se,te]})]})})]}),I&&t&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"border-b px-6 py-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900",children:["Security Officer Details - ",t.first_name," ",t.last_name]}),e.jsx("button",{onClick:()=>m(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),e.jsx("div",{className:"px-6 py-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Personal Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"First Name"}),e.jsx("p",{className:"text-base font-semibold",children:t.first_name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Last Name"}),e.jsx("p",{className:"text-base font-semibold",children:t.last_name})]})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Contact Information"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Email"}),e.jsx("p",{className:"text-base font-semibold",children:t.email})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Phone Number"}),e.jsx("p",{className:"text-base font-semibold",children:t.phone_number||"N/A"})]})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Account Status"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Status"}),e.jsx("span",{className:`inline-block px-2 py-1 rounded-full text-xs font-medium ${t.status==="active"?"bg-success-50 text-success-700":t.status==="pending_approval"?"bg-yellow-50 text-yellow-700":t.status==="suspended"?"bg-red-50 text-red-500":"bg-gray-200 text-gray-700"}`,children:t.status})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Approved"}),e.jsx("p",{className:`text-base font-semibold ${t.is_approved?"text-green-600":"text-red-600"}`,children:t.is_approved?"Yes ✓":"No ✗"})]})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Account Dates"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Joined Date"}),e.jsx("p",{className:"text-base font-semibold",children:t.created_at?new Date(t.created_at).toLocaleDateString():"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Last Login"}),e.jsx("p",{className:"text-base font-semibold",children:t.last_login?new Date(t.last_login).toLocaleDateString():"Never"})]})]})]}),!N&&e.jsxs("div",{className:"border-t pt-4 mt-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Actions"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("button",{onClick:()=>l("approve"),disabled:t.is_approved&&t.status==="active",className:"px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition disabled:bg-gray-300 disabled:cursor-not-allowed",children:t.is_approved?"✓ Already Approved":"Approve Officer"}),e.jsx("button",{onClick:()=>l("reject"),disabled:!t.is_approved&&t.status==="inactive",className:"px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition disabled:bg-gray-300 disabled:cursor-not-allowed",children:!t.is_approved&&t.status==="inactive"?"✗ Already Rejected":"Reject Officer"})]})]}),N==="approve"&&e.jsxs("div",{className:"border-t pt-4 mt-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3 text-green-600",children:"Approve Security Officer"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Approval Notes (Optional)"}),e.jsx("textarea",{value:P,onChange:s=>g(s.target.value),placeholder:"Enter any notes about this approval (e.g., 'Background check completed', 'Training certification verified')...",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"These notes are for internal records only."})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-green-700 mb-2",children:e.jsx("strong",{children:"Approving this security officer will:"})}),e.jsxs("ul",{className:"list-disc list-inside text-sm text-green-600 space-y-1",children:[e.jsx("li",{children:'Set account status to "active"'}),e.jsx("li",{children:"Grant full access to security features"}),e.jsx("li",{children:"Send approval notification to officer"}),e.jsx("li",{children:"Allow officer to manage incidents and patrols"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:U,disabled:o,className:"flex-1 px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition disabled:bg-gray-300 disabled:cursor-not-allowed",children:o?"Approving...":"✓ Confirm Approval"}),e.jsx("button",{onClick:()=>{l(null),g("")},disabled:o,className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition",children:"Cancel"})]})]})]}),N==="reject"&&e.jsxs("div",{className:"border-t pt-4 mt-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3 text-red-600",children:"Reject Security Officer"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Rejection Reason *"}),e.jsx("textarea",{value:b,onChange:s=>y(s.target.value),placeholder:"Enter reason for rejection (e.g., 'Failed background check', 'Incomplete certification', 'Does not meet requirements')...",rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"This reason will be sent to the officer in their notification."})]}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-red-700 mb-2",children:e.jsx("strong",{children:"Rejecting this security officer will:"})}),e.jsxs("ul",{className:"list-disc list-inside text-sm text-red-600 space-y-1",children:[e.jsx("li",{children:'Set account status to "inactive"'}),e.jsx("li",{children:"Deny access to security features"}),e.jsx("li",{children:"Send rejection notification with reason"}),e.jsx("li",{children:"Prevent officer from logging in"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:q,disabled:o||!b.trim(),className:"flex-1 px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition disabled:bg-gray-300 disabled:cursor-not-allowed",children:o?"Rejecting...":"✗ Confirm Rejection"}),e.jsx("button",{onClick:()=>{l(null),y("")},disabled:o,className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition",children:"Cancel"})]})]})]})]})}),e.jsx("div",{className:"border-t px-6 py-4 bg-gray-50",children:e.jsx("button",{onClick:()=>m(!1),disabled:o,className:"w-full px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition disabled:bg-gray-100",children:"Close"})})]})}),M&&t&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900",children:[i==="suspend"&&"Suspend Officer",i==="activate"&&"Reactivate Officer",i==="delete"&&"Delete Officer"]}),e.jsx("button",{onClick:h,className:"text-gray-400 hover:text-gray-600 text-2xl",disabled:f,children:"×"})]})}),e.jsxs("form",{onSubmit:B,className:"p-6 space-y-4",children:[D&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",children:D}),R&&e.jsx("div",{className:"bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg",children:R}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Officer Details:"}),e.jsxs("p",{className:"font-semibold text-gray-900",children:[t.first_name," ",t.last_name]}),e.jsx("p",{className:"text-sm text-gray-600",children:t.email})]}),i==="suspend"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Suspension Reason ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:c.suspension_reason,onChange:s=>w({...c,suspension_reason:s.target.value}),required:!0,rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"Enter reason for suspension..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Suspension Duration (days)"}),e.jsx("input",{type:"number",value:c.suspension_duration_days,onChange:s=>w({...c,suspension_duration_days:parseInt(s.target.value)||90}),min:"1",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Default: 90 days"})]})]}),i==="activate"&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 text-blue-700 px-4 py-3 rounded-lg",children:e.jsx("p",{className:"text-sm",children:"This will reactivate the officer and clear their suspension. They will be able to resume their duties immediately."})}),i==="delete"&&e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",children:[e.jsx("p",{className:"text-sm font-semibold mb-2",children:"⚠️ Warning: This action cannot be undone!"}),e.jsx("p",{className:"text-sm",children:"This will permanently remove the officer from the system. All their data will be marked as deleted."})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:h,disabled:f,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium transition-colors disabled:opacity-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:f,className:`flex-1 px-4 py-2 rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed
                    ${i==="delete"?"bg-red-500 hover:bg-red-600 text-white":i==="activate"?"bg-success-500 hover:bg-success-600 text-white":"bg-yellow-500 hover:bg-yellow-600 text-white"}`,children:f?"Processing...":i==="suspend"?"Suspend Officer":i==="activate"?"Reactivate Officer":"Delete Officer"})]})]})]})})]})},ue=Q(re);export{ue as default};
